<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Schrödinger Equation Visualizer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: 'Arial', sans-serif;
            background-color: #0a0a1e;
            color: #e0f0ff;
        }
        #visualization {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, #0a0a1e, #0f1a3a, #142b5f);
        }
        .button {
            padding: 8px 15px;
            font-size: 14px;
            background-color: rgba(135, 206, 250, 0.2);
            color: #87CEFA;
            border: 1px solid #87CEFA;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .button:hover {
            background-color: rgba(135, 206, 250, 0.4);
        }
        #more-info {
            position: absolute;
            left: 20px;
            bottom: 20px;
        }
        #controls {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: flex-end;
        }
        #explanation {
            position: absolute;
            left: 20px;
            top: 20px;
            width: 300px;
            max-height: 80%;
            overflow-y: auto;
            padding: 20px;
            background-color: rgba(10, 10, 30, 0.9);
            border-radius: 15px;
            display: none;
            box-shadow: 0 0 20px rgba(135, 206, 250, 0.3);
        }
        #explanation h2 {
            color: #87CEFA;
            margin-top: 0;
        }
        .formula {
            font-style: italic;
            margin: 15px 0;
            font-size: 1.2em;
            color: #ffd700;
        }
        #tooltip {
            position: absolute;
            background-color: rgba(10, 10, 30, 0.9);
            color: #e0f0ff;
            padding: 10px;
            border-radius: 5px;
            font-size: 14px;
            pointer-events: none;
            display: none;
        }
    </style>
</head>
<body>
    <div id="visualization"></div>
    <button id="more-info" class="button">More Info</button>
    <div id="controls">
        <button id="change-potential" class="button">Change Potential</button>
        <button id="add-energy" class="button">Add Energy</button>
        <button id="measure" class="button">Measure Position</button>
        <button id="reset" class="button">Reset</button>
    </div>
    <div id="explanation">
        <h2>The Schrödinger Equation Visualizer</h2>
        <p>This interactive simulation brings the Schrödinger equation to life, demonstrating key concepts of quantum mechanics.</p>
        <p class="formula">iℏ ∂Ψ/∂t = ĤΨ</p>
        <p><strong>Key Components:</strong></p>
        <ul>
            <li><strong>Wave Function (Ψ):</strong> The colorful undulating wave represents the quantum state of the particle.</li>
            <li><strong>Potential Energy (V):</strong> The white line shows the potential energy landscape.</li>
            <li><strong>Probability Density (|Ψ|²):</strong> The white area at the bottom represents the probability of finding the particle at each position.</li>
        </ul>
        <p><strong>Interactions:</strong></p>
        <ul>
            <li>Click and drag on the visualization to perturb the wave function.</li>
            <li>Use the buttons to alter the simulation and observe quantum effects.</li>
        </ul>
        <p>Explore how changes in potential and energy affect the quantum state, and witness the probabilistic nature of quantum measurements!</p>
    </div>
    <div id="tooltip"></div>

    <script>
        let waveFunction;
        let potential;
        let particle;
        let time = 0;
        let measurementMade = false;

        function setup() {
            let canvas = createCanvas(windowWidth, windowHeight);
            canvas.parent('visualization');
            waveFunction = new WaveFunction();
            potential = new Potential();
            particle = new Particle();
            noStroke();
        }

        function draw() {
            background(10, 10, 30);
            
            potential.display();
            waveFunction.update();
            waveFunction.display();
            
            if (measurementMade) {
                particle.display();
            }
            
            time += 0.01;
        }

        class WaveFunction {
            constructor() {
                this.amplitude = [];
                this.phase = [];
                for (let i = 0; i < width; i++) {
                    this.amplitude[i] = sin(i * 0.05) * exp(-pow(i - width/2, 2) / 10000);
                    this.phase[i] = random(TWO_PI);
                }
            }
            
            update() {
                for (let i = 0; i < width; i++) {
                    this.phase[i] += 0.1 * potential.getValue(i);
                    this.amplitude[i] *= 0.999;
                    
                    if (i > 0) {
                        this.amplitude[i] += 0.01 * (this.amplitude[i-1] - this.amplitude[i]);
                    }
                    if (i < width - 1) {
                        this.amplitude[i] += 0.01 * (this.amplitude[i+1] - this.amplitude[i]);
                    }
                }
            }
            
            display() {
                beginShape();
                for (let i = 0; i < width; i++) {
                    let y = height/2 + this.amplitude[i] * 100 * sin(this.phase[i] + time);
                    fill(127 + 127 * sin(this.phase[i]), 127 + 127 * cos(this.phase[i]), 200, 150);
                    vertex(i, y);
                }
                endShape();
                
                for (let i = 0; i < width; i++) {
                    let probability = this.amplitude[i] * this.amplitude[i];
                    fill(255, 255, 255, probability * 200);
                    rect(i, height * 0.8, 1, -probability * height * 0.6);
                }
            }
        }

        class Potential {
            constructor() {
                this.values = [];
                this.regenerate();
            }
            
            regenerate() {
                for (let i = 0; i < width; i++) {
                    this.values[i] = noise(i * 0.01) * 2 - 1;
                }
            }
            
            getValue(x) {
                return this.values[x];
            }
            
            display() {
                stroke(255);
                noFill();
                beginShape();
                for (let i = 0; i < width; i++) {
                    vertex(i, map(this.values[i], -1, 1, height * 0.8, height * 0.2));
                }
                endShape();
            }
        }

        class Particle {
            constructor() {
                this.x = random(width);
                this.y = height/2;
            }
            
            display() {
                fill(255, 255, 0);
                ellipse(this.x, this.y, 10, 10);
            }
        }

        function changePotential() {
            potential.regenerate();
        }

        function addEnergy() {
            for (let i = 0; i < width; i++) {
                waveFunction.amplitude[i] += random(-0.1, 0.1);
            }
        }

        function measure() {
            let totalProbability = 0;
            for (let i = 0; i < width; i++) {
                totalProbability += waveFunction.amplitude[i] * waveFunction.amplitude[i];
            }
            
            let randomPoint = random(totalProbability);
            let cumulativeProbability = 0;
            
            for (let i = 0; i < width; i++) {
                cumulativeProbability += waveFunction.amplitude[i] * waveFunction.amplitude[i];
                if (cumulativeProbability >= randomPoint) {
                    particle.x = i;
                    particle.y = height/2 + waveFunction.amplitude[i] * 100 * sin(waveFunction.phase[i] + time);
                    break;
                }
            }
            
            measurementMade = true;
        }

        function resetSimulation() {
            waveFunction = new WaveFunction();
            potential = new Potential();
            measurementMade = false;
            time = 0;
        }

        function windowResized() {
            resizeCanvas(windowWidth, windowHeight);
            waveFunction = new WaveFunction();
            potential = new Potential();
        }

        function mouseDragged() {
            if (mouseX > 0 && mouseX < width && mouseY > 0 && mouseY < height) {
                let clickStrength = 0.5;
                let clickWidth = width / 10;
                for (let i = 0; i < width; i++) {
                    let distance = abs(i - mouseX);
                    if (distance < clickWidth) {
                        let effect = clickStrength * (1 - distance / clickWidth);
                        waveFunction.amplitude[i] += effect * (mouseY < height/2 ? 1 : -1);
                    }
                }
            }
        }

        document.getElementById('change-potential').addEventListener('click', changePotential);
        document.getElementById('add-energy').addEventListener('click', addEnergy);
        document.getElementById('measure').addEventListener('click', measure);
        document.getElementById('reset').addEventListener('click', resetSimulation);

        document.getElementById('more-info').addEventListener('click', function() {
            let explanation = document.getElementById('explanation');
            explanation.style.display = explanation.style.display === 'none' ? 'block' : 'none';
        });

        // Tooltip functionality
        const buttons = document.querySelectorAll('.button');
        const tooltip = document.getElementById('tooltip');

        buttons.forEach(button => {
            button.addEventListener('mouseover', (e) => {
                let text;
                switch(e.target.id) {
                    case 'more-info':
                        text = "Show/hide detailed explanation";
                        break;
                    case 'change-potential':
                        text = "Alter the potential energy landscape";
                        break;
                    case 'add-energy':
                        text = "Introduce random energy fluctuations";
                        break;
                    case 'measure':
                        text = "Perform a quantum measurement";
                        break;
                    case 'reset':
                        text = "Reset the simulation to its initial state";
                        break;
                }
                tooltip.textContent = text;
                tooltip.style.display = 'block';
                tooltip.style.left = `${e.pageX + 10}px`;
                tooltip.style.top = `${e.pageY + 10}px`;
            });

            button.addEventListener('mouseout', () => {
                tooltip.style.display = 'none';
            });
        });
    </script>
</body>
</html>
