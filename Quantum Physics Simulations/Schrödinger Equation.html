<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Schrödinger Equation</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: Arial, sans-serif;
            background-color: #1a1a2e;
            color: #87CEFA;
        }
        #visualization {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, #1a1a2e, #16213e, #0f3460);
        }
        #text-toggle {
            position: absolute;
            left: 10px;
            bottom: 10px;
            padding: 5px 10px;
            background-color: rgba(0, 0, 0, 0.5);
            color: #87CEFA;
            border: 1px solid #87CEFA;
            border-radius: 5px;
            cursor: pointer;
        }
        #explanation {
            position: absolute;
            left: 10px;
            bottom: 50px;
            width: 300px;
            max-height: 80%;
            overflow-y: auto;
            padding: 15px;
            background-color: rgba(0, 0, 0, 0.8);
            border-radius: 10px;
            display: none;
        }
        #controls {
            position: absolute;
            bottom: 10px;
            right: 10px;
            display: flex;
            justify-content: center;
            gap: 10px;
            background-color: rgba(0,0,0,0.5);
            padding: 10px;
            border-radius: 10px;
        }
        #controls button {
            padding: 5px 10px;
            font-size: 12px;
            background-color: rgba(135, 206, 250, 0.2);
            color: #87CEFA;
            border: 1px solid #87CEFA;
            border-radius: 5px;
            cursor: pointer;
        }
        .formula {
            font-style: italic;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div id="visualization"></div>
    <button id="text-toggle">Toggle Info</button>
    <div id="explanation">
        <h2>The Schrödinger Equation</h2>
        <p>The Schrödinger equation describes how the quantum state of a physical system changes over time.</p>
        <p class="formula">iℏ ∂Ψ/∂t = ĤΨ</p>
        <p>Where:</p>
        <ul>
            <li>i is the imaginary unit</li>
            <li>ℏ is the reduced Planck constant</li>
            <li>Ψ (Psi) is the wave function</li>
            <li>t is time</li>
            <li>Ĥ is the Hamiltonian operator</li>
        </ul>
        <p><strong>In the Animation:</strong></p>
        <ul>
            <li>The colorful wave represents the wave function Ψ</li>
            <li>The white line shows the potential energy</li>
            <li>The yellow dot appears when you measure the particle's position</li>
            <li>Interact with the buttons to change the simulation</li>
        </ul>
    </div>
    <div id="controls">
        <button id="change-potential">Change Potential</button>
        <button id="add-energy">Add Energy</button>
        <button id="measure">Measure Position</button>
        <button id="reset">Reset</button>
    </div>

    <script>
        let waveFunction;
        let potential;
        let particle;
        let time = 0;
        let measurementMade = false;

        function setup() {
            let canvas = createCanvas(windowWidth, windowHeight);
            canvas.parent('visualization');
            waveFunction = new WaveFunction();
            potential = new Potential();
            particle = new Particle();
            noStroke();
        }

        function draw() {
            background(30);
            
            potential.display();
            waveFunction.update();
            waveFunction.display();
            
            if (measurementMade) {
                particle.display();
            }
            
            time += 0.01;
        }

        class WaveFunction {
            constructor() {
                this.amplitude = [];
                this.phase = [];
                for (let i = 0; i < width; i++) {
                    this.amplitude[i] = sin(i * 0.05) * exp(-pow(i - width/2, 2) / 10000);
                    this.phase[i] = random(TWO_PI);
                }
            }
            
            update() {
                for (let i = 0; i < width; i++) {
                    this.phase[i] += 0.1 * potential.getValue(i);
                    this.amplitude[i] *= 0.999;
                    
                    // Apply periodic boundary conditions
                    if (i > 0) {
                        this.amplitude[i] += 0.01 * (this.amplitude[i-1] - this.amplitude[i]);
                    }
                    if (i < width - 1) {
                        this.amplitude[i] += 0.01 * (this.amplitude[i+1] - this.amplitude[i]);
                    }
                }
            }
            
            display() {
                beginShape();
                for (let i = 0; i < width; i++) {
                    let y = height/2 + this.amplitude[i] * 100 * sin(this.phase[i] + time);
                    fill(127 + 127 * sin(this.phase[i]), 127 + 127 * cos(this.phase[i]), 200, 150);
                    vertex(i, y);
                }
                endShape();
                
                // Display probability density
                for (let i = 0; i < width; i++) {
                    let probability = this.amplitude[i] * this.amplitude[i];
                    fill(255, 255, 255, probability * 200);
                    rect(i, height * 0.8, 1, -probability * height * 0.6);
                }
            }
        }

        class Potential {
            constructor() {
                this.values = [];
                this.regenerate();
            }
            
            regenerate() {
                for (let i = 0; i < width; i++) {
                    this.values[i] = noise(i * 0.01) * 2 - 1;
                }
            }
            
            getValue(x) {
                return this.values[x];
            }
            
            display() {
                stroke(255);
                noFill();
                beginShape();
                for (let i = 0; i < width; i++) {
                    vertex(i, map(this.values[i], -1, 1, height * 0.8, height * 0.2));
                }
                endShape();
            }
        }

        class Particle {
            constructor() {
                this.x = random(width);
                this.y = height/2;
            }
            
            display() {
                fill(255, 255, 0);
                ellipse(this.x, this.y, 10, 10);
            }
        }

        function changePotential() {
            potential.regenerate();
        }

        function addEnergy() {
            for (let i = 0; i < width; i++) {
                waveFunction.amplitude[i] += random(-0.1, 0.1);
            }
        }

        function measure() {
            let totalProbability = 0;
            for (let i = 0; i < width; i++) {
                totalProbability += waveFunction.amplitude[i] * waveFunction.amplitude[i];
            }
            
            let randomPoint = random(totalProbability);
            let cumulativeProbability = 0;
            
            for (let i = 0; i < width; i++) {
                cumulativeProbability += waveFunction.amplitude[i] * waveFunction.amplitude[i];
                if (cumulativeProbability >= randomPoint) {
                    particle.x = i;
                    particle.y = height/2 + waveFunction.amplitude[i] * 100 * sin(waveFunction.phase[i] + time);
                    break;
                }
            }
            
            measurementMade = true;
        }

        function resetSimulation() {
            waveFunction = new WaveFunction();
            potential = new Potential();
            measurementMade = false;
            time = 0;
        }

        function windowResized() {
            resizeCanvas(windowWidth, windowHeight);
            waveFunction = new WaveFunction();
            potential = new Potential();
        }

        function mousePressed() {
            if (mouseX > 0 && mouseX < width && mouseY > 0 && mouseY < height) {
                let clickStrength = 0.5;
                let clickWidth = width / 10;
                for (let i = 0; i < width; i++) {
                    let distance = abs(i - mouseX);
                    if (distance < clickWidth) {
                        let effect = clickStrength * (1 - distance / clickWidth);
                        waveFunction.amplitude[i] += effect * (mouseY < height/2 ? 1 : -1);
                    }
                }
            }
        }

        document.getElementById('change-potential').addEventListener('click', changePotential);
        document.getElementById('add-energy').addEventListener('click', addEnergy);
        document.getElementById('measure').addEventListener('click', measure);
        document.getElementById('reset').addEventListener('click', resetSimulation);

        document.getElementById('text-toggle').addEventListener('click', function() {
            let explanation = document.getElementById('explanation');
            explanation.style.display = explanation.style.display === 'none' ? 'block' : 'none';
        });
    </script>
</body>
</html>
