<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Quantum Spirituality Animation</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #000;
            color: #fff;
            font-family: Arial, sans-serif;
        }
        #explanation {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 300px;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 5px;
        }
        .button {
            position: absolute;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            color: white;
        }
        #startButton {
            bottom: 20px;
            left: 20px;
            background-color: blue;
        }
        #nextButton {
            bottom: 20px;
            left: 150px;
            background-color: green;
        }
        #downloadButton {
            bottom: 20px;
            right: 20px;
            background-color: purple;
        }
    </style>
</head>
<body>
    <div id="explanation"></div>
    <button id="startButton" class="button">Start Animation</button>
    <button id="nextButton" class="button">Next Scene</button>
    <button id="downloadButton" class="button">Download MP4</button>
    <script>
        let currentScene = 0;
        let objects = [];
        let observer;
        let meditator;
        let activeCharacter;
        let mirrors = [];
        let presenceParticles = [];
        let font;
        let canvas;
        let isAnimating = false;
        let totalScenes = 7;

        function preload() {
            font = loadFont('https://cdnjs.cloudflare.com/ajax/libs/topcoat/0.8.0/font/SourceSansPro-Regular.otf');
        }

        function setup() {
            canvas = createCanvas(1000, 600, WEBGL);
            textFont(font);
            textSize(18);
            textAlign(CENTER, CENTER);

            initializeObjects();

            document.getElementById('startButton').addEventListener('click', startAnimation);
            document.getElementById('nextButton').addEventListener('click', nextScene);
            document.getElementById('downloadButton').addEventListener('click', downloadMP4);

            document.getElementById('nextButton').style.display = 'none';
            document.getElementById('downloadButton').style.display = 'none';
        }

        function draw() {
            background(0);
            orbitControl();

            if (isAnimating) {
                displaySceneInfo();
                drawCurrentScene();
            } else {
                push();
                fill(255);
                textSize(24);
                text("Click 'Start Animation' to begin", 0, 0);
                pop();
            }
        }

        function startAnimation() {
            isAnimating = true;
            currentScene = 0;
            document.getElementById('startButton').style.display = 'none';
            document.getElementById('nextButton').style.display = 'inline-block';
            document.getElementById('downloadButton').style.display = 'inline-block';
        }

        function nextScene() {
            currentScene = (currentScene + 1) % totalScenes;
            presenceParticles = [];
        }

        function displaySceneInfo() {
            let title = getSceneTitle();
            let summary = getSceneSummary();
            document.getElementById('explanation').innerHTML = `<h3>${title}</h3><p>${summary}</p>`;
        }

        function getSceneTitle() {
            const titles = [
                "1. The Observer Effect",
                "2. Duality of Action and Non-Action",
                "3. Paravritti (180-degree turn-over)",
                "4. The Illusion of the Separate Self",
                "5. The Paradox of Seeking",
                "6. Presence in Absence",
                "7. The Non-dual Nature of Reality"
            ];
            return titles[currentScene];
        }

        function getSceneSummary() {
            const summaries = [
                "Objects appear and disappear based on observation, illustrating how the observer affects reality.",
                "Both action and inaction are forms of 'doing' when there is a 'doer'.",
                "The cessation of both doing and non-doing, represented by a dissolving self.",
                "All things are interconnected; the separation is an illusion.",
                "Looking for the self as an object is futile, like trying to see one's own eyes.",
                "True presence emerges in the absence of the seeking self.",
                "Reality transcends duality, being neither form nor emptiness, yet both."
            ];
            return summaries[currentScene];
        }

        function drawRotatingSphere(x, y, z, size, rotationSpeed, col) {
            push();
            translate(x, y, z);
            rotateY(frameCount * rotationSpeed);
            fill(col);
            sphere(size);
            pop();
        }

        function drawCurrentScene() {
            switch(currentScene) {
                case 0: drawObserverEffect(); break;
                case 1: drawDualityOfAction(); break;
                case 2: drawParavritti(); break;
                case 3: drawIllusionOfSeparateSelf(); break;
                case 4: drawParadoxOfSeeking(); break;
                case 5: drawPresenceInAbsence(); break;
                case 6: drawNonDualNature(); break;
            }
        }

        function drawObserverEffect() {
            drawRotatingSphere(observer.x, observer.y, observer.z, observer.size, observer.rotationSpeed, observer.color);

            for (let obj of objects) {
                if (obj.visible) {
                    drawRotatingSphere(obj.x, obj.y, obj.z, obj.size, obj.rotationSpeed, obj.color);
                }
            }

            let looking = mouseIsPressed;
            for (let obj of objects) {
                obj.visible = looking;
            }
        }

        function drawDualityOfAction() {
            drawRotatingSphere(meditator.x, meditator.y, meditator.z, meditator.size, meditator.rotationSpeed, meditator.color);
            drawRotatingSphere(activeCharacter.x, activeCharacter.y, activeCharacter.z, activeCharacter.size, activeCharacter.rotationSpeed, activeCharacter.color);

            push();
            fill(255);
            text("Meditation", meditator.x, meditator.y + 50);
            text("Action", activeCharacter.x, activeCharacter.y + 50);
            text("Both are 'doing'", 0, 100);
            pop();

            // Interactive: Move characters with mouse
            if (mouseIsPressed) {
                meditator.x = mouseX - width/2;
                activeCharacter.x = -meditator.x;
            }
        }

        function drawParavritti() {
            let t = frameCount * 0.05;
            
            push();
            for (let i = 0; i < 100; i++) {
                let angle = noise(i, t) * TWO_PI;
                let radius = noise(i, t + 1000) * 100;
                let x = cos(angle) * radius;
                let y = sin(angle) * radius;
                let z = noise(i, t + 2000) * 100 - 50;
                
                fill(noise(i) * 255, noise(i + 1000) * 255, noise(i + 2000) * 255, 100);
                translate(x, y, z);
                sphere(3);
            }
            pop();

            // Interactive: Change dissolution speed with mouse Y position
            let dissolutionSpeed = map(mouseY, 0, height, 0.01, 0.1);
            t *= dissolutionSpeed;
        }

        function drawIllusionOfSeparateSelf() {
            for (let i = 0; i < objects.length; i++) {
                let obj = objects[i];
                drawRotatingSphere(obj.x, obj.y, obj.z, obj.size, obj.rotationSpeed, obj.color);

                for (let j = i + 1; j < objects.length; j++) {
                    let other = objects[j];
                    stroke(lerpColor(obj.color, other.color, 0.5));
                    line(obj.x, obj.y, obj.z, other.x, other.y, other.z);
                }
            }

            // Interactive: Move objects with mouse
            if (mouseIsPressed) {
                let closestObj = null;
                let minDist = Infinity;
                for (let obj of objects) {
                    let d = dist(mouseX - width/2, mouseY - height/2, obj.x, obj.y);
                    if (d < minDist) {
                        minDist = d;
                        closestObj = obj;
                    }
                }
                if (closestObj) {
                    closestObj.x = mouseX - width/2;
                    closestObj.y = mouseY - height/2;
                }
            }
        }

        function drawParadoxOfSeeking() {
            for (let mirror of mirrors) {
                push();
                translate(mirror.x, mirror.y, mirror.z);
                rotateY(mirror.rotY);
                fill(200);
                plane(100, 150);
                pop();
            }

            // Interactive: Control seeker with mouse
            let x = mouseX - width/2;
            let y = mouseY - height/2;
            drawRotatingSphere(x, y, 0, 20, 0.05, color(255, 165, 0));
        }

        function drawPresenceInAbsence() {
            if (mouseIsPressed && frameCount % 5 === 0) {
                presenceParticles.push({
                    x: mouseX - width/2,
                    y: mouseY - height/2,
                    z: random(-200, 200),
                    size: random(5, 15),
                    rotationSpeed: random(0.01, 0.05),
                    color: color(random(255), random(255), random(255))
                });
            }

            for (let i = presenceParticles.length - 1; i >= 0; i--) {
                let p = presenceParticles[i];
                drawRotatingSphere(p.x, p.y, p.z, p.size, p.rotationSpeed, p.color);

                p.size -= 0.1;
                if (p.size <= 0) {
                    presenceParticles.splice(i, 1);
                }
            }
        }

        function drawNonDualNature() {
            let t = frameCount * 0.05;
            
            push();
            rotateX(t);
            rotateY(t * 0.5);
            let morphFactor = map(mouseX, 0, width, 0, 1);
            let vertices = [];
            
            for (let i = 0; i < 100; i++) {
                let lat = map(i, 0, 99, -PI/2, PI/2);
                for (let j = 0; j < 100; j++) {
                    let lon = map(j, 0, 99, -PI, PI);
                    let x = cos(lat) * cos(lon);
                    let y = cos(lat) * sin(lon);
                    let z = sin(lat);
                    
                    let r = 150 + 50 * noise(x * 0.1, y * 0.1, z * 0.1 + t * 0.1);
                    r = lerp(r, 100, morphFactor);
                    
                    vertices.push(x * r, y * r, z * r);
                }
            }
            
            stroke(255);
            beginShape(POINTS);
            for (let i = 0; i < vertices.length; i += 3) {
                let col = color(noise(i) * 255, noise(i + 1000) * 255, noise(i + 2000) * 255);
                stroke(col);
                vertex(vertices[i], vertices[i+1], vertices[i+2]);
            }
            endShape();
            
            pop();
        }

        function downloadMP4() {
            saveCanvas(canvas, 'quantum_spirituality', 'mp4');
        }

        function initializeObjects() {
            for (let i = 0; i < 5; i++) {
                objects.push({
                    x: random(-200, 200),
                    y: random(-200, 200),
                    z: random(-200, 200),
                    size: random(20, 50),
                    visible: true,
                    rotationSpeed: random(0.01, 0.05),
                    color: color(random(255), random(255), random(255))
                });
            }

            observer = {
                x: 0,
                y: 0,
                z: 200,
                size: 30,
                rotationSpeed: 0.02,
                color: color(255, 0, 0)
            };

            meditator = { x: -100, y: 0, z: 0, size: 40, rotationSpeed: 0.01, color: color(0, 255, 0) };
            activeCharacter = { x: 100, y: 0, z: 0, size: 40, rotationSpeed: 0.03, color: color(0, 0, 255) };

            for (let i = 0; i < 5; i++) {
                mirrors.push({
                    x: cos(TWO_PI * i / 5) * 200,
                    y: sin(TWO_PI * i / 5) * 200,
                    z: 0,
                    rotY: TWO_PI * i / 5
                });
            }
        }
    </script>
</body>
</html>
